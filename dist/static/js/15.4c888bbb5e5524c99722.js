webpackJsonp([15],{"Bs/r":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("HzJ8"),n=i.n(a),l=i("aA9S"),s=i.n(l),r=i("Pfph"),o={name:"AuthSetting",data:function(){var t=this;return{list:[],data:[],menuArry:[],total:null,tempid:void 0,listQuery:{page:1,page_size:20,sort:"-created_at",permission_name:void 0,menu_name:void 0},allAuthOptions:[],i:0,allAuthLoading:!1,listLoading:!1,dialogAuthGroupVisible:!1,dialogFormVisible:!1,dialogAuthVisible:!1,tableKey:0,dialogStatus:"",dialogTitle:{update:"编辑",create:"创建"},defaultProps:{children:"children",label:"menu_name"},props:{value:"id",label:"menu_name",children:"children"},temp1:{id:[],auth_name:void 0,auth_code:void 0},temp:{id:void 0,user_menu_id:void 0,permission_name:void 0,menuArry:void 0},tempData:{user_account_auth_id:void 0,menu_list:[]},rules:{auth_code:[{required:!0,trigger:"blur",validator:function(e,i,a){/^[a-zA-Z]*\/[a-zA-Z]*\/[a-zA-Z]*$/.test(t.temp.auth_code)?a():a(new Error("请输入权限"))}}]},rules2:{permission_name:[{required:!0,trigger:"change",message:"必填"}]},updataData:void 0}},filters:{statusGradeColor:function(t){return{0:"success",1:"danger",2:"warning",3:"info"}[t]},statusGradeText:function(t){return{0:"全部数据",1:"本人数据",2:"本组数据",3:"本组及子组数据"}[t]}},created:function(){this.getMenuList(),this.getList()},methods:{handleFilter:function(){this.listQuery.page=1,this.getList()},handleInnerSizeChange1:function(t){this.listQuery.page_size=t,this.getList()},handleInnerCurrentChange1:function(t){this.listQuery.page=t,this.getList()},getMenuList:function(){var t=this;Object(r.n)().then(function(e){t.data=e.data})},getList:function(){var t=this;this.listLoading=!0,Object(r.m)(this.listQuery).then(function(e){t.total=e.data.total,t.list=e.data.data,t.listLoading=!1})},resetTemp:function(){this.temp={id:void 0,user_menu_id:void 0,permission_name:void 0,menuArry:void 0}},handleCreate:function(){var t=this;this.resetTemp(),this.menuArry=[],this.dialogStatus="create",this.dialogAuthVisible=!0,this.$nextTick(function(){t.$refs.innerDataForm2.clearValidate()})},CreateAuth:function(){var t=this,e={permission_id:this.tempid,auth_list:this.temp1.id};Object(r.i)(e).then(function(e){for(var i in t.list)t.list[i].id===t.temp.id&&(t.list[i].user_account_auth=e.data.user_account_auth);t.getList(),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"编辑成功",type:"success",duration:2e3})})},handleUpdate:function(t){var e=this;this.temp=s()({},t),this.temp.menuArry=t.menu_root,this.dialogStatus="update",this.dialogAuthVisible=!0,this.$nextTick(function(){e.$refs.innerDataForm2.clearValidate()})},handleDelete:function(t){var e=this;this.$confirm("此操作将永久删除该权限组, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.f)({permission_id:t.id}).then(function(i){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3});var a=e.list.indexOf(t);e.list.splice(a,1),e.total--})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},CreateAuthManager:function(){var t=this;this.$refs.innerDataForm2.validate(function(e){e&&(t.temp.user_menu_id=t.temp.menuArry[t.temp.menuArry.length-1],Object(r.c)(t.temp).then(function(e){t.dialogAuthVisible=!1,t.getList(),t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}))})},updataAuthManager:function(){var t=this;this.$refs.innerDataForm2.validate(function(e){if(e){var i=s()({},t.temp);i.user_menu_id=t.temp.menuArry[t.temp.menuArry.length-1],i.permission_id=t.temp.id,Object(r.q)(i).then(function(e){t.getList(),t.dialogAuthVisible=!1,t.$notify({title:"成功",message:"编辑成功",type:"success",duration:2e3})})}})},getAllAuth:function(t){var e=this;""!==t&&(this.allAuthLoading=!0,Object(r.k)({auth_code:t,page_size:0}).then(function(t){e.allAuthOptions=t.data,e.allAuthLoading=!1}))},handleAddAuth:function(t){console.log(t),this.tempid=t.id,this.allAuthOptions=[],this.temp1.id=[];var e=!0,i=!1,a=void 0;try{for(var l,s=n()(t.user_account_auth);!(e=(l=s.next()).done);e=!0){var r=l.value;this.allAuthOptions.push(r),this.temp1.id.push(r.id)}}catch(t){i=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw a}}this.dialogFormVisible=!0},handleItemChange:function(t){console.log("active item:",t)}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container calendar-list-container"},[i("div",{staticClass:"filter-container"},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"350px"},attrs:{clearable:"",placeholder:"操作名称"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.handleFilter(e)}},model:{value:t.listQuery.permission_name,callback:function(e){t.$set(t.listQuery,"permission_name",e)},expression:"listQuery.permission_name"}}),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"350px"},attrs:{clearable:"",placeholder:"菜单搜索"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.handleFilter(e)}},model:{value:t.listQuery.menu_name,callback:function(e){t.$set(t.listQuery,"menu_name",e)},expression:"listQuery.menu_name"}}),t._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("创建权限组")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{stripe:!0,data:t.list,"element-loading-text":"给我一点时间",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{"min-width":"70px",align:"center",label:"操作名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"link-type",on:{click:function(i){t.handleUpdate(e.row)}}},[t._v(t._s(e.row.permission_name))])]}}])}),t._v(" "),i("el-table-column",{attrs:{"min-width":"100px",align:"center",label:"路径"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.menu_path))])]}}])}),t._v(" "),i("el-table-column",{attrs:{width:"130px",align:"center",label:"菜单名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:"info"}},[t._v(t._s(e.row.user_menu.menu_name))])]}}])}),t._v(" "),i("el-table-column",{attrs:{"min-width":"100px",align:"center",label:"接口名称 / 权限等级"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.user_account_auth,function(a){return i("div",[0!==e.row.user_account_auth.length?i("el-tag",{attrs:{type:"primary"}},[t._v(t._s(a.auth_name))]):t._e(),t._v(" "),i("el-tag",{attrs:{type:t._f("statusGradeColor")(a.auth_grade)}},[t._v(t._s(t._f("statusGradeText")(a.auth_grade)))]),t._v(" "),i("br")],1)})}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"300","class-name":"small-padding"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.handleAddAuth(e.row)}}},[t._v("编辑API")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.handleUpdate(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){t.handleDelete(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.listLoading,expression:"!listLoading"}],staticClass:"pagination-container"},[i("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[10,20,50,100],"page-size":t.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleInnerSizeChange1,"current-change":t.handleInnerCurrentChange1,"update:currentPage":function(e){t.$set(t.listQuery,"page",e)}}})],1),t._v(" "),i("el-dialog",{attrs:{title:t.dialogTitle[t.dialogStatus],visible:t.dialogFormVisible,width:"70%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"innerDataForm",staticStyle:{width:"100%"},attrs:{rules:t.rules,model:t.temp1,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"权限名称",prop:"auth_name"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",remote:"",placeholder:"请选择api","remote-method":t.getAllAuth,loading:t.allAuthLoading},model:{value:t.temp1.id,callback:function(e){t.$set(t.temp1,"id",e)},expression:"temp1.id"}},t._l(t.allAuthOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.auth_name,value:e.id}},[i("el-tag",{staticClass:"select_tag",attrs:{type:t._f("statusGradeColor")(e.auth_grade)}},[t._v(t._s(t._f("statusGradeText")(e.auth_grade)))]),t._v(" "),i("span",[t._v(t._s(e.auth_name))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","margin-right":"20px"}},[t._v(t._s(e.auth_code))])],1)}))],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.CreateAuth}},[t._v("确 定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.dialogTitle[t.dialogStatus],visible:t.dialogAuthVisible},on:{"update:visible":function(e){t.dialogAuthVisible=e}}},[i("el-form",{ref:"innerDataForm2",staticStyle:{width:"80%","margin-left":"10%"},attrs:{rules:t.rules2,model:t.temp,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"权限组名称",prop:"permission_name"}},[i("el-input",{model:{value:t.temp.permission_name,callback:function(e){t.$set(t.temp,"permission_name",e)},expression:"temp.permission_name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"菜单名称",prop:"menuArry"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{"change-on-select":"",options:t.data,props:t.props},on:{"active-item-change":t.handleItemChange},model:{value:t.temp.menuArry,callback:function(e){t.$set(t.temp,"menuArry",e)},expression:"temp.menuArry"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogAuthVisible=!1}}},[t._v("取 消")]),t._v(" "),"create"==t.dialogStatus?i("el-button",{attrs:{type:"primary"},on:{click:t.CreateAuthManager}},[t._v("确 定")]):i("el-button",{attrs:{type:"primary"},on:{click:t.updataAuthManager}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]},c=i("/Xao")(o,u,!1,function(t){i("umMm")},"data-v-da556c82",null);e.default=c.exports},p6VC:function(t,e,i){(t.exports=i("UTlt")(!1)).push([t.i,"\n.select_tag[data-v-da556c82] {\n  margin-right: 20px;\n  line-height: 20px;\n  height: 20px;\n}\n",""])},umMm:function(t,e,i){var a=i("p6VC");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("8bSs")("4c3566f1",a,!0)}});